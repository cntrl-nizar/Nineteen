<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nine</title>
<link rel="stylesheet" href="css/site.css">
<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/loaders/babylon.glTF2FileLoader.js"></script>
<script src="js/scene_camera.js"></script>
<script src="js/joystick.js"></script>
  

</head>
<body>
<canvas id="renderCanvas" style="width:100%; height:100vh;"></canvas>
<div id="joystick">
  <div id="stick"></div>
</div>
<!-- Ancient Letter Modal -->
<div id="ancientModal">
  
    <p id="ancientModalText"></p>
    <button id="closeModal">Close</button>
</div>

<script>
// Grab modal elements
const modal = document.getElementById("ancientModal");
const modalText = document.getElementById("ancientModalText");
const closeBtn = document.getElementById("closeModal");

// Close button hides modal
closeBtn.addEventListener("click", () => { modal.style.display = "none"; });

// Override global alert
window.alert = function(message) {
    modalText.innerText = message;
    modal.style.display = "block";
};
</script>

<!-- Player -->
<script>
// Player as digit "9"
const player = new BABYLON.TransformNode("player", scene);
const plane = BABYLON.MeshBuilder.CreatePlane("playerPlane", {width:1, height:2}, scene);
plane.parent = player;
plane.position.y = 1;

const dt = new BABYLON.DynamicTexture("dt", {width:512, height:1024}, scene, false);
const mat = new BABYLON.StandardMaterial("playerMat", scene);
mat.diffuseTexture = dt;
mat.backFaceCulling = false;
mat.diffuseTexture.hasAlpha = true;
mat.useAlphaFromDiffuseTexture = true;
plane.material = mat;

dt.drawText("9", null, 800, "bold 800px Arial", "white", null, true);
</script>


<!-- Path & Floor -->
<script>
// Enable collisions globally
scene.collisionsEnabled = true;

// -------- FLOOR (plain) --------
const floor = BABYLON.MeshBuilder.CreateGround("floor",{width:20,height:200},scene);
const floorMat = new BABYLON.StandardMaterial("floorMat",scene);
floorMat.diffuseColor = new BABYLON.Color3(0.15,0.15,0.15); // neutral dark
floor.material = floorMat;
floor.checkCollisions = true;

// -------- PATH --------
const path = BABYLON.MeshBuilder.CreateGround("path",{width:4,height:200},scene);
path.position.y = 0.02;
const pathMat = new BABYLON.StandardMaterial("pathMat",scene);
pathMat.diffuseColor = new BABYLON.Color3(1,1,1);
path.material = pathMat;
path.checkCollisions = true;
</script>


<!-- Stars / Sky -->
<script>

// Black sky
scene.clearColor = new BABYLON.Color3(0,0,0);

const starParent = new BABYLON.TransformNode("starParent", scene);

// Keep stars centered on the player so you never reach the edge
scene.onBeforeRenderObservable.add(()=>{
    starParent.position.copyFrom(player.position);
});

const radius = 80; // distance from player

const colors = [
"#ff9cf0","#ffb3f5","#ff7ae6","#ff5cd6","#ffc2fb",
"#e38cff","#d070ff","#b266ff","#9a4dff","#c299ff",
"#7a33ff","#5f1aff","#f2e6ff","#e0ccff",
"#fff27a","#ffe95c","#ffdf33","#fff599","#fff1b3",
"#ffd700","#ffcc00","#fff7cc"
];

for(let i = 0; i < 1000; i++){

    const star = BABYLON.MeshBuilder.CreatePlane("star"+i,{size:2},scene);

    star.parent = starParent;
    star.isPickable = false;
    star.billboardMode = BABYLON.Mesh.BILLBOARDMODE_ALL;

    // TRUE spherical distribution
    const theta = Math.random() * Math.PI * 2;     // around
    const phi = Math.acos(2*Math.random() - 1);    // up/down

    star.position = new BABYLON.Vector3(
        radius * Math.sin(phi) * Math.cos(theta),
        radius * Math.cos(phi),
        radius * Math.sin(phi) * Math.sin(theta)
    );

    const dt = new BABYLON.DynamicTexture("dt"+i,{width:256,height:256},scene,false);
    const mat = new BABYLON.StandardMaterial("mat"+i,scene);

    mat.diffuseTexture = dt;
    mat.emissiveColor = new BABYLON.Color3(1,1,1);
    mat.disableLighting = true;
    mat.useAlphaFromDiffuseTexture = true;
    mat.backFaceCulling = false;

    star.material = mat;

    // alternate digits
    const digit = (i % 2 === 0) ? "1" : "9";

    const color = colors[Math.floor(Math.random()*colors.length)];

    dt.drawText(
        digit,
        null,
        180,
        "bold 180px Arial",
        color,
        null,
        true
    );
}


// -------- CLICKABLE MESSAGE --------
// create mesh
const clickStar = BABYLON.MeshBuilder.CreatePlane("clickStar",{size:6},scene);

clickStar.parent = starParent;
clickStar.billboardMode = BABYLON.Mesh.BILLBOARDMODE_ALL;
clickStar.position = new BABYLON.Vector3(0, 10, radius - 10);
clickStar.isPickable = true;

// texture
const clickDT = new BABYLON.DynamicTexture("clickDT",{width:512,height:256},scene,false);
const clickMat = new BABYLON.StandardMaterial("clickMat",scene);

clickMat.diffuseTexture = clickDT;
clickMat.emissiveColor = new BABYLON.Color3(1,1,1);
clickMat.disableLighting = true;
clickMat.useAlphaFromDiffuseTexture = true;
clickMat.backFaceCulling = false;

clickStar.material = clickMat;

// draw text
clickDT.drawText(
    "other side",
    null,
    160,
    "bold 120px Arial",
    "#ffffff",
    null,
    true
);

// make clickable
clickStar.actionManager = new BABYLON.ActionManager(scene);
clickStar.actionManager.registerAction(
    new BABYLON.ExecuteCodeAction(
        BABYLON.ActionManager.OnPickTrigger,
        starMessage
    )
);

// function to call
function starMessage(){
    alert("hi");
}
</script>


<script>
// Function to create a clickable billboard with custom onclick callback
// imgURL: string - image URL
// position: BABYLON.Vector3 - where to place the billboard
// size: number - width/height
// onClick: function - your custom code to run when clicked
function createBillboard(imgURL, position, size = 3, onClick = () => {}) {
    // Root node for easy manipulation
    const billboardNode = new BABYLON.TransformNode("billboardNode", scene);

    // Create plane
    const billboard = BABYLON.MeshBuilder.CreatePlane("billboard", { width: size, height: size }, scene);
    billboard.parent = billboardNode;

    // Set position
    billboard.position.copyFrom(position);

    // Make it always face the camera
    billboard.billboardMode = BABYLON.Mesh.BILLBOARDMODE_ALL;

    // Material
    const billboardMat = new BABYLON.StandardMaterial("billboardMat", scene);
    billboardMat.diffuseTexture = new BABYLON.Texture(imgURL, scene);
    billboardMat.emissiveColor = new BABYLON.Color3(1,1,1); // glow
    billboard.material = billboardMat;

    // Add click action using the callback
    billboard.actionManager = new BABYLON.ActionManager(scene);
    billboard.actionManager.registerAction(
        new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger, onClick)
    );

    return billboardNode;
}

// Example usage:
createBillboard(
    "https://akm-img-a-in.tosshub.com/sites/dailyo//resources/202311/copy-of-g2-cover-2091123125338.png?size=*:480",
    new BABYLON.Vector3(3, 1, 50),
    3,
    () => { 
        alert("Hi! onclick()."); 
    }
);
</script>




<script>
// Function to load a model into the scene
// modelName: string, e.g. "chicken.glb"
// position: BABYLON.Vector3, e.g. new BABYLON.Vector3(4,0.5,4)
// scale: number, default small (0.005)
// clickable: boolean, whether clicking shows alert
function loadModel(modelName, position, scale = 0.005, clickable = true) {
    BABYLON.SceneLoader.Append("model/", modelName, scene, function(scene) {

        // Create a root node for the imported model
        const modelRoot = new BABYLON.TransformNode(modelName + "Root", scene);

        // Parent only meshes that are not already part of other objects
        scene.meshes.forEach(mesh => {
            if (!mesh.parent && mesh.name !== "playerPlane" && mesh.name !== "floor" && mesh.name !== "path") {
                mesh.parent = modelRoot;
            }
        });

        // Scale the model
        modelRoot.scaling = new BABYLON.Vector3(scale, scale, scale);

        // Set the model position
        modelRoot.position = position;

        // Optional: make clickable
        if (clickable) {
            modelRoot.actionManager = new BABYLON.ActionManager(scene);
            modelRoot.actionManager.registerAction(
                new BABYLON.ExecuteCodeAction(
                    BABYLON.ActionManager.OnPickTrigger, 
                    () => { alert(modelName + " clicked!"); }
                )
            );
        }
    });
}

// Example usage:
loadModel("chicken.glb", new BABYLON.Vector3(4, 0.5, 4));
</script>



</body>
</html>
















